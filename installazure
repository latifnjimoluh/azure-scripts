az network public-ip create --resource-group TP-Azure-Migration --name natgw-public-ip --sku Standard --allocation-method Static && az network nat gateway create --resource-group TP-Azure-Migration --name natgw-frontend --public-ip-addresses natgw-public-ip --idle-timeout 10 && az network vnet subnet update --resource-group TP-Azure-Migration --vnet-name vnet-app --name subnet-frontend --nat-gateway natgw-frontend && az vmss create --resource-group TP-Azure-Migration --name vmss-frontend-v2 --image Ubuntu2204 --upgrade-policy-mode Automatic --instance-count 2 --vm-sku Standard_B1s --vnet-name vnet-app --subnet subnet-frontend --admin-username azureuser --ssh-key-values @"C:\Users\nexus\.ssh\id_rsa.pub" --backend-pool-name appGatewayBackendPool && az vmss extension set --resource-group TP-Azure-Migration --vmss-name vmss-frontend-v2 --name CustomScript --publisher Microsoft.Azure.Extensions --version 2.1 --settings @config.json


az vmss list-instances --resource-group TP-Azure-Migration --name vmss-frontend-v2 --query "[].{id:id}" -o tsv | while read id; do az vmss nic list --resource-group TP-Azure-Migration --vmss-name vmss-frontend-v2 --instance-id "$(basename $id)" --query "[].ipConfigurations[].privateIpAddress" -o tsv; done
az network application-gateway address-pool update --gateway-name AppGateway01 --resource-group TP-Azure-Migration --name appGatewayBackendPool --set backendAddresses="[{\"ipAddress\":\"10.0.1.X\"},{\"ipAddress\":\"10.0.1.Y\"}]"
